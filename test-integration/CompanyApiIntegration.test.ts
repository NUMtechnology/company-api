import { expect } from 'chai';
import { buildNumUri } from 'num-client';
import { CompanyApiOptions, createCompanyApi } from '../src/CompanyApi';

describe('Company API Integration Tests', () => {
  it('Can lookup a NUM URI using a CompanyApi instance with depth of 0', async () => {
    const api = createCompanyApi();

    const result = await api.lookupUri(buildNumUri('axa.co.uk'), new CompanyApiOptions(0, 0));
    expect(result).not.null;
    const resultStr = JSON.stringify(result);
    expect(resultStr).to.equal('{}');
  });

  it('Can lookup a NUM URI using a CompanyApi instance with contacts depth of 1, images depth of 0', async () => {
    const api = createCompanyApi();

    const result = await api.lookupUri(buildNumUri('axa.co.uk'), new CompanyApiOptions(1, 0));
    expect(result).not.null;
    const resultStr = JSON.stringify(result);
    expect(resultStr).to.equal(
      '{"organisation":{"object_display_name":"Organisation","name":"AXA","slogan":null,"contacts":[{"link":{"@L":"car","description":"Car and Motor Insurance"}},{"link":{"@L":"home","description":"Home Insurance"}},{"link":{"@L":"travel","description":"Travel Insurance"}},{"link":{"@L":"landlord","description":"Landlord Insurance"}},{"link":{"@L":"business","description":"Business Insurance"}},{"link":{"@L":"health","description":"Healthcare Insurance"}},{"twitter":{"object_display_name":"Twitter","description_default":"View Twitter profile","description":null,"prefix":"https://www.twitter.com/","method_type":"third_party","controller":"twitter.com","value":"AXAUK","value_prefix":"@"}},{"facebook":{"object_display_name":"Facebook","description_default":"View Facebook profile","description":null,"prefix":"https://www.facebook.com/","method_type":"third_party","controller":"facebook.com","value":"axainsurance"}},{"youtube":{"object_display_name":"YouTube","description_default":"View YouTube channel","description":null,"prefix":"https://www.youtube.com/","method_type":"third_party","controller":"youtube.com","value":"AXAUK"}},{"instagram":{"object_display_name":"Instagram","description_default":"View Instagram profile","description":null,"prefix":"https://www.instagram.com/","method_type":"third_party","controller":"instagram.com","value":"axa_uk"}}]}}'
    );
  });

  it('Can lookup a NUM URI using a CompanyApi instance with contacts depth of 2, images depth of 0', async () => {
    const api = createCompanyApi();

    const result = await api.lookupUri(buildNumUri('axa.co.uk'), new CompanyApiOptions(2, 0));
    expect(result).not.null;
    const resultStr = JSON.stringify(result);
    expect(resultStr).to.equal(
      '{"organisation":{"object_display_name":"Organisation","name":"AXA","slogan":null,"contacts":[{"link":{"@L":"car","description":"Car and Motor Insurance","department":{"object_display_name":"Department","name":"Car and Motor Insurance","description":"Car Insurance","contacts":[{"link":{"@L":"/van","description":"Van Insurance"}},{"link":{"@L":"/breakdown","description":"Breakdown Cover"}},{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a car insurance quote online","prefix":"https://","method_type":"core","value":"secure.axainsurance.com/Sales/PersonalLines/AXADirect/AXA/Motor/Standard/Desktop/Quote/yourdetails?_adal_sd=www.axa.co.uk.1617883383888&_adal_ca=so26me26ca(not)3D(not)3D(not).1617883383888&_adal_cw=1617708738962.1617883383888&_adal_id=fb25d991-9a5b-42c7-b457-d9c3e7153796.1617708739.3.1617883382.1617713957.a591c0c5-7cfe-4cda-83c3-5c0a2fe536b9.1617883383888&_gl=1*1mw8qz5*_ga*MTY4NzY5MTIzMy4xNjE3NzA4NzM5*_ga_RE55ZQSXB7*MTYxNzg4MjMzMC4yLjEuMTYxNzg4MzM4MS42MA.."}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations","prefix":"tel:","method_type":"core","value":"+44330 024 1158","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations (Northern Ireland)","prefix":"tel:","method_type":"core","value":"+44289 002 0104","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-16"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Get a quote for a new policy","prefix":"tel:","method_type":"core","value":"+44333 241 3545","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Manage your No Claims Discount","prefix":"tel:","method_type":"core","value":"+44330 024 1157","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Manage your payments","prefix":"tel:","method_type":"core","value":"+44330 024 1229","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Make a car insurance claim","prefix":"tel:","method_type":"core","value":"+44330 024 1305","hours":{"time_zone_location":"LON","available":["wd@8-18","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Make a car insurance claim from abroad","prefix":"tel:","method_type":"core","value":"+44121 752 0685","hours":{"time_zone_location":"LON","available":["wd@8-18","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Windscreen repair","prefix":"tel:","method_type":"core","value":"+44330 024 1306","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Breakdown assistance UK","prefix":"tel:","method_type":"core","value":"+44800 197 1121","hours":{"time_zone_location":"LON","available":["d@0-24"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Breakdown assistance Europe","prefix":"tel:","method_type":"core","value":"+44 173 781 5375","hours":{"time_zone_location":"LON","available":["d@0-24"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"General complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1158","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claims complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1305","hours":{"time_zone_location":"LON","available":["wd@8-20"]}}}]}}},{"link":{"@L":"home","description":"Home Insurance","department":{"object_display_name":"Department","name":"Home Insurance","description":null,"contacts":[{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a quote online","prefix":"https://","method_type":"core","value":"secure.axainsurance.com/Sales/PersonalLines/Home/Standard/Quote/yourdetails?_adal_sd=www.axa.co.uk.1617967270210&_adal_ca=so26me26ca(not)3D(not)3D(not).1617967270210&_adal_cw=1617708738962.1617967270210&_adal_id=fb25d991-9a5b-42c7-b457-d9c3e7153796.1617708739.5.1617967267.1617886889.fe530d56-2ec7-4457-959a-5d3b1e2b6616.1617967270210&_gl=1*1rd77fm*_ga*MTY4NzY5MTIzMy4xNjE3NzA4NzM5*_ga_RE55ZQSXB7*MTYxNzk2NzI2NS40LjAuMTYxNzk2NzI2NS42MA..&_ga=2.93125405.1874298784.1617882331-1687691233.1617708739"}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations","prefix":"tel:","method_type":"core","value":"+44330 024 1235","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations (Northern Ireland)","prefix":"tel:","method_type":"core","value":"+44289 002 0104","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-16"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Quotes","prefix":"tel:","method_type":"core","value":"+44330 058 4118","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Manage your payments","prefix":"tel:","method_type":"core","value":"+44330 024 1239","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Make a home insurance claim","prefix":"tel:","method_type":"core","value":"+44330 024 8086","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Home assistance claim","prefix":"tel:","method_type":"core","value":"+44330 024 1259","hours":{"time_zone_location":"LON","available":["d@0-24"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Legal advice and expenses claim","prefix":"tel:","method_type":"core","value":"+44330 024 1278","hours":{"time_zone_location":"LON","available":["d@0-24"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Policy complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1235","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-15"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claims complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1277","hours":{"time_zone_location":"LON","available":["wd@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Legal expenses complaints","prefix":"tel:","method_type":"core","value":"+44120 661 5000","hours":{"time_zone_location":"LON","available":["wd@9-17.30"]}}}]}}},{"link":{"@L":"travel","description":"Travel Insurance","department":{"object_display_name":"Department","name":"Travel Insurance","description":null,"contacts":[{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a quote online","prefix":"https://","method_type":"core","value":"secure.axainsurance.com/Sales/PersonalLines/AXADirect/AXA/Travel/Standard/Desktop/Quote/travelyourdetails?_adal_sd=www.axa.co.uk.1617972768178&_adal_ca=so26me26ca(not)3D(not)3D(not).1617972768178&_adal_cw=1617708738962.1617972768178&_adal_id=fb25d991-9a5b-42c7-b457-d9c3e7153796.1617708739.5.1617968921.1617886889.fe530d56-2ec7-4457-959a-5d3b1e2b6616.1617972768178&_gl=1*1vanxpt*_ga*MTY4NzY5MTIzMy4xNjE3NzA4NzM5*_ga_RE55ZQSXB7*MTYxNzk2NzI2NS40LjEuMTYxNzk2ODkyMC42MA..&_ga=2.240113667.1874298784.1617882331-1687691233.1617708739"}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations","prefix":"tel:","method_type":"core","value":"+44330 024 1307","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-16"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Manage your payments","prefix":"tel:","method_type":"core","value":"+44330 024 1229","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Emergency medical/ repatriation","prefix":"tel:","method_type":"core","value":"+44173 781 5626","hours":{"time_zone_location":"LON","available":["d@0-24"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Make a travel insurance claim","prefix":"tel:","method_type":"core","value":"+44330 024 1308","hours":{"time_zone_location":"LON","available":["wd@8-20"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Legal advice and expenses claim","prefix":"tel:","method_type":"core","value":"+44330 024 1309","hours":{"time_zone_location":"LON","available":["wd@8.30-19","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claims complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1308","hours":{"time_zone_location":"LON","available":["wd@8.30-19","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Policy complaints","prefix":"tel:","method_type":"core","value":"+44330 024 1307","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17","7@9-16"]}}}]}}},{"link":{"@L":"landlord","description":"Landlord Insurance","department":{"object_display_name":"Department","name":"Landlord Insurance","description":null,"contacts":[{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a quote online","prefix":"https://","method_type":"core","value":"www.landlordaxainsurance.com/AWE/Container.aspx?_adal_sd=www.axa.co.uk.1617973278116&_adal_ca=so26me26ca(not)3D(not)3D(not).1617973278116&_adal_cw=1617708738962.1617973278116&_adal_id=fb25d991-9a5b-42c7-b457-d9c3e7153796.1617708739.6.1617973274.1617968921.1e11f357-a129-4f2c-97d6-38498c45e361.1617973278116&CurrentStep=ClientDetails&CurrentWorkflow=Direct&ProductTarget=AXAPropertyOwners&ProductVariation=AXARPO&_gl=1*1y1zgw*_ga*MTY4NzY5MTIzMy4xNjE3NzA4NzM5*_ga_RE55ZQSXB7*MTYxNzk3Mjc3My41LjEuMTYxNzk3MzI3My42MA..&_ga=2.260887309.1874298784.1617882331-1687691233.1617708739"}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services, complaints and cancellations","prefix":"tel:","method_type":"core","value":"+44330 159 1512","hours":{"time_zone_location":"LON","available":["wd@8-18"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Sales enquiries","prefix":"tel:","method_type":"core","value":"+44330 159 1522","hours":{"time_zone_location":"LON","available":["wd@8-18"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Landlord insurance claims","prefix":"tel:","method_type":"core","value":"+44345 600 2715","hours":{"time_zone_location":"LON","available":["d@0-24"]}}}]}}},{"link":{"@L":"business","description":"Business Insurance","department":{"object_display_name":"Department","name":"Business Insurance","description":null,"contacts":[{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a quote online","prefix":"https://","method_type":"core","value":"secure.axainsurance.com/Sales/CommercialLines/AXACommercialDirect/AXA/CommercialDirect/Standard/Desktop/Quote/gettingStarted"}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Customer services and cancellations","prefix":"tel:","method_type":"core","value":"+44330 159 1508","hours":{"time_zone_location":"LON","available":["wd@8-18"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Sales enquiries","prefix":"tel:","method_type":"core","value":"+44330 159 1520","hours":{"time_zone_location":"LON","available":["wd@8-18"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Manage your payments","prefix":"tel:","method_type":"core","value":"+44330 159 1525","hours":{"time_zone_location":"LON","available":["wd@8-18"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Business new and existing claims","prefix":"tel:","method_type":"core","value":"+44345 600 2715","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Professional indemnity existing claims","prefix":"tel:","method_type":"core","value":"+44844 381 4418","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claims complaints","prefix":"tel:","method_type":"core","value":"+44345 600 2715","hours":{"time_zone_location":"AD"}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Policy complaints","prefix":"tel:","method_type":"core","value":"+44330 159 1508","hours":{"time_zone_location":"AD"}}}]}}},{"link":{"@L":"health","description":"Healthcare Insurance","department":{"object_display_name":"Department","name":"Health Insurance","description":null,"contacts":[{"url":{"object_display_name":"Web URL","description_default":"Click","description":"Get a quote online","prefix":"https://","method_type":"core","value":"epmi.axahealth.co.uk/?_adal_sd=www.axa.co.uk.1617974005834&_adal_ca=so26me26ca(not)3D(not)3D(not).1617974005834&_adal_cw=1617708738962.1617974005834&_adal_id=fb25d991-9a5b-42c7-b457-d9c3e7153796.1617708739.6.1617974003.1617968921.1e11f357-a129-4f2c-97d6-38498c45e361.1617974005834&_ga=2.27071677.1874298784.1617882331-1687691233.1617708739"}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Get a quote or buy a private healthcare plan","prefix":"tel:","method_type":"core","value":"+44800 111 4004","hours":{"time_zone_location":"LON","available":["wd@9-19"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claim for back, joint or muscle pain","prefix":"tel:","method_type":"core","value":"+44800 029 4236","hours":{"time_zone_location":"LON"}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claim for a mental health condition","prefix":"tel:","method_type":"core","value":"+44800 521 903","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Claims for membership number starting with AXA (i.e. AXA/R1234567)","prefix":"tel:","method_type":"core","value":"+44800 027 1384","hours":{"time_zone_location":"AD"}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"All other claims or unkown membership number","prefix":"tel:","method_type":"core","value":"+44800 132 203","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Make a change to your plan","prefix":"tel:","method_type":"core","value":"+44345 607 6280","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Invoice or payment queries","prefix":"tel:","method_type":"core","value":"+44800 029 4233","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Help with your online account","prefix":"tel:","method_type":"core","value":"+44800 302 9133","hours":{"time_zone_location":"LON","available":["wd@8-17","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Send feedback for membership number starting with AXA (i.e. AXA/R1234567)","prefix":"tel:","method_type":"core","value":"+44800 027 1384","hours":{"time_zone_location":"LON"}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Send feedback if you don’t know your membership number","prefix":"tel:","method_type":"core","value":"+44800 132 203","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Cancel your plan","prefix":"tel:","method_type":"core","value":"+44189 251 2345","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Cancel AXA Health plan provided by your employer","prefix":"tel:","method_type":"core","value":"+44800 032 1965","hours":{"time_zone_location":"LON","available":["wd@8-20","6@9-17"]}}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Overseas calls","prefix":"tel:","method_type":"core","value":"+44189 251 2345","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Health at Hand experts","prefix":"tel:","method_type":"core","value":"+44800 003 004","hours":null}},{"telephone":{"object_display_name":"Telephone","description_default":"Call","description":"Find an English speaking Doctor while abroad","prefix":"tel:","method_type":"core","value":"+44189 277 2578","hours":null}}]}}},{"twitter":{"object_display_name":"Twitter","description_default":"View Twitter profile","description":null,"prefix":"https://www.twitter.com/","method_type":"third_party","controller":"twitter.com","value":"AXAUK","value_prefix":"@"}},{"facebook":{"object_display_name":"Facebook","description_default":"View Facebook profile","description":null,"prefix":"https://www.facebook.com/","method_type":"third_party","controller":"facebook.com","value":"axainsurance"}},{"youtube":{"object_display_name":"YouTube","description_default":"View YouTube channel","description":null,"prefix":"https://www.youtube.com/","method_type":"third_party","controller":"youtube.com","value":"AXAUK"}},{"instagram":{"object_display_name":"Instagram","description_default":"View Instagram profile","description":null,"prefix":"https://www.instagram.com/","method_type":"third_party","controller":"instagram.com","value":"axa_uk"}}]}}'
    );
  });
});
